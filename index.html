<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Mahjong Tracker üÄÑ</title>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
      max-width: 900px; margin: 0 auto; padding: 20px; 
      background: linear-gradient(to bottom, #f5f8fc, #f0f4f9, #e8edf5); 
      color: #1f2937; 
    }
    h1 { text-align: center; margin-bottom: 10px; color: #1e40af; }
    #subtitle { text-align: center; color: #4b5563; margin-bottom: 30px; font-style: italic; }
    
    #summary { 
      display: flex; justify-content: space-between; flex-wrap: nowrap; gap: 10px; 
      margin-bottom: 25px; padding: 16px; border-radius: 16px; 
      background: rgba(255,255,255,0.92); box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
      overflow-x: auto; white-space: nowrap; backdrop-filter: blur(4px);
    }
    .player-sum { 
      text-align: center; min-width: 120px; padding: 12px 14px; border-radius: 12px; 
      background: #f9fafb; transition: all 0.2s; flex-shrink: 0; 
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.04);
    }
    .player-sum:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
    .player-sum strong { display: block; font-size: 1.25em; margin-bottom: 4px; color: #111827; }
    .net-positive { background: #ecfdf5 !important; color: #065f46; }
    .net-negative { background: #fef2f2 !important; color: #991b1b; }
    
    #nav { text-align: center; margin-bottom: 25px; }
    button { 
      background: #3b82f6; color: white; border: none; padding: 10px 20px; 
      border-radius: 8px; cursor: pointer; font-size: 1.1em; margin: 0 8px; 
      transition: all 0.2s; 
    }
    button:hover { background: #2563eb; transform: translateY(-1px); }
    
    #calendar { 
      background: #fdfdfd; border-radius: 16px; padding: 25px; 
      box-shadow: 0 6px 20px rgba(0,0,0,0.06); border: 1px solid #e5e7eb;
    }
    .weekdays { 
      display: flex; font-weight: bold; background: #f1f5f9; 
      border-radius: 10px; padding: 12px; margin-bottom: 15px; color: #1e40af; 
    }
    .weekday { flex: 1; text-align: center; }
    .week { display: flex; margin-bottom: 6px; }
    .day { 
      flex: 1; min-height: 120px; display: flex; flex-direction: column; 
      align-items: flex-start; justify-content: flex-start; 
      border: 1px solid #d1d5db; border-radius: 12px; margin: 0 3px; cursor: pointer; 
      font-weight: bold; font-size: 1.3em; transition: all 0.2s; 
      background: #fefefe; padding: 6px 4px; box-sizing: border-box;
    }
    .day:hover { border-color: #3b82f6; background: #f0f9ff; }
    .day.other-month { color: #9ca3af; border-color: #e5e7eb; background: #f9fafb; cursor: default; }
    .day.other-month:hover { background: #f9fafb; border-color: #e5e7eb; }
    .day.net-positive { background: #f0fdf4 !important; border-color: #86efac; }
    .day.net-negative { background: #fef2f2 !important; border-color: #fca5a5; }
    
    .day-result {
      font-size: 0.72em; line-height: 1.25; margin: 1px 0; width: 100%;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .result-positive { color: #15803d; font-weight: 600; }
    .result-negative { color: #b91c1c; font-weight: 600; }
    
    /* Modal */
    #modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;
    }
    #modal-content {
      background: #fefefe; padding: 35px; border-radius: 20px; max-width: 620px; width: 92%;
      box-shadow: 0 15px 40px rgba(0,0,0,0.25); border: 1px solid #e5e7eb;
    }
    #modal-title { font-size: 1.6em; margin: 0 0 25px; text-align: center; color: #1e40af; }
    .player-entry { 
      display: flex; align-items: center; justify-content: space-between; 
      margin: 18px 0; font-size: 1.15em; padding: 10px; border-radius: 10px; 
      background: #f9fafb; 
    }
    .player-entry label { flex: 1; font-weight: 600; color: #1f2937; }
    .player-entry input { 
      width: 130px; height: 48px; font-size: 1.4em; text-align: center; 
      border: 1px solid #d1d5db; border-radius: 10px; padding: 0 12px; 
      background: white; transition: border 0.2s; 
    }
    .player-entry input:focus { 
      border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); outline: none; 
    }
    #modal-buttons { text-align: center; margin-top: 30px; }
    #close-modal { background: #6b7280; }
    #close-modal:hover { background: #4b5563; }
    #save-modal { background: #16a34a; }
    #save-modal:hover { background: #15803d; }
    
    #status { text-align: center; margin-top: 20px; font-style: italic; color: #4b5563; }
  </style>
</head>
<body>
  <h1>2026 Mahjong Tracker üÄÑ</h1>
  <p id="subtitle">Track net points per player (+ = win, ‚Äì = loss) üÉè</p>
  
  <div id="summary"></div>
  
  <div id="nav">
    <button onclick="prevMonth()">‚Üê Prev Month</button>
    <span id="month-year" style="font-size: 1.2em; font-weight: bold; margin: 0 30px; color: #1e40af;"></span>
    <button onclick="nextMonth()">Next Month ‚Üí</button>
  </div>
  
  <div id="calendar"></div>
  <p id="status">Click a day to enter scores ‚Üí net values only for players who won/lost ‚Üí Save</p>

  <!-- Modal -->
  <div id="modal">
    <div id="modal-content">
      <h2 id="modal-title">Edit Day</h2>
      <div id="player-entries"></div>
      <div id="modal-buttons">
        <button id="close-modal" onclick="closeModal()">Close</button>
        <button id="save-modal" onclick="saveAndClose()">Save</button>
      </div>
    </div>
  </div>

  <script>
    const players = ['Gina', 'Anders', 'Kaylee', 'Philip', 'Rosie', 'Anfern'];
    const initials = players.map(n => n.charAt(0));
    let currentYear = 2026;
    let currentMonth = 0;
    let data = {};
    let editingKey = null;

    function loadData() {
      const saved = localStorage.getItem('mj2026-net');
      data = saved ? JSON.parse(saved) : {};
    }

    function saveData() {
      localStorage.setItem('mj2026-net', JSON.stringify(data));
    }

    function daysInMonth(y, m) { return new Date(y, m + 1, 0).getDate(); }
    function firstDayOfMonth(y, m) { return new Date(y, m, 1).getDay(); }

    function calcSummary(y, m) {
      const nets = {};
      players.forEach(p => nets[p] = 0);
      for (let d = 1; d <= daysInMonth(y, m); d++) {
        const key = `${y}-${m + 1}-${d}`;
        if (data[key]) {
          players.forEach(p => nets[p] += (data[key][p] || 0));
        }
      }
      return nets;
    }

    function updateSummary() {
      const nets = calcSummary(currentYear, currentMonth);
      document.getElementById('summary').innerHTML = players.map(p => {
        const net = nets[p];
        const sign = net > 0 ? '+' : net < 0 ? '' : '';
        const cls = net > 0 ? 'net-positive' : net < 0 ? 'net-negative' : '';
        return `<div class="player-sum ${cls}"><strong>${p}</strong><br>${sign}${net}</div>`;
      }).join('');
    }

    function updateCalendar() {
      document.getElementById('month-year').textContent = 
        new Date(currentYear, currentMonth, 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
      
      const cal = document.getElementById('calendar');
      const daysInCur = daysInMonth(currentYear, currentMonth);
      const firstDOW = firstDayOfMonth(currentYear, currentMonth);
      
      let html = '<div class="weekdays">' + 
        ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d => `<div class="weekday">${d}</div>`).join('') + 
        '</div>';

      let week = [];
      for (let i = 0; i < firstDOW; i++) {
        const prevD = daysInMonth(currentYear, currentMonth - 1) - firstDOW + i + 1;
        week.push(`<div class="day other-month">${prevD}</div>`);
      }
      
      for (let d = 1; d <= daysInCur; d++) {
        week.push(createDay(d));
        if (week.length === 7) {
          html += `<div class="week">${week.join('')}</div>`;
          week = [];
        }
      }
      
      while (week.length < 7) week.push(`<div class="day other-month"></div>`);
      if (week.length) html += `<div class="week">${week.join('')}</div>`;
      
      cal.innerHTML = html;
      updateSummary();
    }

    function createDay(d) {
      const key = `${currentYear}-${currentMonth + 1}-${d}`;
      const dayData = data[key] || {};
      let results = '';
      
      players.forEach((p, i) => {
        const val = dayData[p] || 0;
        if (val !== 0) {
          const sign = val > 0 ? '+' : '';
          const cls = val > 0 ? 'result-positive' : 'result-negative';
          results += `<div class="day-result ${cls}">${initials[i]}: ${sign}${val}</div>`;
        }
      });

      const totalNet = players.reduce((s, p) => s + (dayData[p] || 0), 0);
      const dayCls = totalNet > 0 ? 'net-positive' : totalNet < 0 ? 'net-negative' : '';

      return `<div class="day ${dayCls}" onclick="openEdit('${key}', ${d})">
        <div style="align-self: center; margin-bottom: 4px;">${d}</div>
        ${results}
      </div>`;
    }

    function openEdit(key, dayNum) {
      editingKey = key;
      const dateStr = new Date(currentYear, currentMonth, dayNum).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
      document.getElementById('modal-title').textContent = `Edit ${dateStr}`;
      
      const entriesDiv = document.getElementById('player-entries');
      entriesDiv.innerHTML = '';
      const dayData = data[key] || {};
      
      players.forEach(p => {
        const val = dayData[p] ?? '';
        entriesDiv.innerHTML += `
          <div class="player-entry">
            <label>${p}</label>
            <input type="number" value="${val}" data-player="${p}" 
                   onkeypress="if(event.key==='Enter') saveAndClose()">
          </div>`;
      });
      
      document.getElementById('modal').style.display = 'flex';
      entriesDiv.querySelector('input').focus();
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      editingKey = null;
    }

    function saveAndClose() {
      if (!editingKey) return;
      const inputs = document.querySelectorAll('#player-entries input');
      let hasData = false;
      const dayObj = {};
      
      inputs.forEach(inp => {
        const val = parseInt(inp.value) || 0;
        const player = inp.dataset.player;
        if (val !== 0) {
          dayObj[player] = val;
          hasData = true;
        }
      });
      
      if (hasData) data[editingKey] = dayObj;
      else delete data[editingKey];
      
      saveData();
      updateCalendar();
      closeModal();
    }

    document.getElementById('modal').addEventListener('click', e => {
      if (e.target === document.getElementById('modal')) closeModal();
    });

    function prevMonth() {
      currentMonth--;
      if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      updateCalendar();
    }

    function nextMonth() {
      currentMonth++;
      if (currentMonth > 11) { currentMonth = 0; currentYear++; }
      updateCalendar();
    }

    loadData();
    updateCalendar();
  </script>
</body>
</html>
